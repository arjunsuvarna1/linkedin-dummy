define("msg-typeahead/components/connections-typeahead-v2",["exports","ember-copy","msg-shared/utils/constants","msg-typeahead/templates/components/connections-typeahead-v2","ember-batcher"],function(e,t,i,s,n){"use strict"
Object.defineProperty(e,"__esModule",{value:!0})
e.default=void 0
var a={},c=i.default.KEYCODES,l=i.default.MESSAGE_TYPEAHEAD_SEARCH_TYPES,o=l.CONNECTIONS,r=l.GROUP_THREADS,d=i.default.MESSAGE_TYPEAHEAD_RESULT_TYPES,p=d.CONVERSATION,h=d.PROFILE,u=i.default.LIX.ENABLE_GROUP_COMPOSE_FLOW,g=i.default.ENABLE_GROUP_COMPOSE_FLOW_VARIANTS,m=Ember.Component.extend({layout:s.default,a11yNotification:Ember.inject.service("global-services@a11y-notification"),i18n:Ember.inject.service("i18n"),msgDataManager:Ember.inject.service("msg-data@data-manager"),store:Ember.inject.service("store"),tracking:Ember.inject.service("tracking"),lix:Ember.inject.service("lix"),classNameBindings:["isFocused:msg-connections-typeahead--focused","withSuggestedList:msg-connections-typeahead-with-suggested-list"],classNames:["msg-connections-typeahead","relative"],addRecipientControlName:"search_add",openConversationControlName:"search_add_group",beginSearchControlName:"begin_recipient_search",searchTerm:"",searchFieldClass:"msg-connections-typeahead__search-field",hiddenFieldSelector:".msg-connections-typeahead__hidden-field",searchFieldSelector:".msg-connections-typeahead__search-field",searchResultsSelector:".msg-connections-typeahead__search-results",addedRecipientsSelector:".msg-connections-typeahead__added-recipients",CONVERSATION:p,displaySearchIcon:Ember.computed("showSearchIcon","recipients.length",(function(){return this.get("showSearchIcon")&&0===this.get("recipients.length")})).readOnly(),displaySearchResults:Ember.computed("searchPerformed","isFocused","withSuggestedList",(function(){return this.get("withSuggestedList")||this.get("searchPerformed")&&this.get("isFocused")})).readOnly(),init:function(){this._super.apply(this,arguments)
var e=this.get("lix").getTreatment(u)
this.set("enableGroupComposeFlow",e===g.GROUP_COMPOSE_AND_NO_PROFILE_PHOTO||e===g.GROUP_COMPOSE_AND_DROPDOWN_MENU)
if(this.get("enableGroupComposeFlow")&&this.get("withSuggestedList")){this.searchResultsSelector=".msg-connections-typeahead__inplace-search-results"
this._fetchSuggestedRecipients()}},didInsertElement:function(){this._super.apply(this,arguments)
this.addedRecipientsContainer=this.element.querySelector(this.get("addedRecipientsSelector"))},didReceiveAttrs:function(){this._super.apply(this,arguments)
this.set("recipients",(0,t.copy)(this.get("prefilledRecipients"))||[])
this._markSelectedRecipients()},focusIn:function(e){var t=this
this.runTask((function(){if(!t.get("isDestroying")){t.set("isFocused",!0)
var i=t.get("possibleRecipients")
if(i){var s=e.target&&e.target.id,n=i.findBy("entityUrn",s)
n&&t._setFocusedRecipient(n)}}}))},focusOut:function(){var e=this
this.runTask((function(){e.get("isDestroying")||e.set("isFocused",!1)}))},click:function(e){e.target===this.element&&this._focusSearchField()},keyDown:function(e){switch(e.keyCode){case c.UP_ARROW:this._moveFocusedRecipient(-1)
e.preventDefault()
break
case c.DOWN_ARROW:this._moveFocusedRecipient(1)
e.preventDefault()
break
case c.BACKSPACE:if(e.target.classList.contains(this.get("searchFieldClass"))&&!e.target.value){var t=this.get("recipients.lastObject")
t&&this.actions.removeRecipient.call(this,t)}break
case c.ENTER:if(e.target===this._getSearchField()){var i=this.get("focusedRecipient"),s=this.get("focusedRecipient.recipientType")
s===p?this.get("openConversation")(i.get("conversationId")):s===h&&this.actions.addRecipient.call(this,i.get("miniProfile"))}break
case c.ESC:this._closeDropdown()
this._markSelectedRecipients()}},_closeDropdown:function(){this.set("searchPerformed",!1)
this.get("withSuggestedList")?this.setProperties({possibleRecipients:this.get("suggestedRecipients"),isSuggestedList:!0}):this.set("possibleRecipients",null)},_ensureRecipientIsScrolledIntoView:function(e){if(e.get("entityUrn")){var t=e.get("entityUrn").replace(/:/g,"\\:"),i=this.element&&this.element.querySelector("#"+t)
if(i){var s=i.offsetTop,n=s+i.offsetHeight,a=this.element.querySelector(this.get("searchResultsSelector")),c=a.offsetHeight,l=a.scrollTop
n>l+c?a.scrollTop=n-c:s<l&&(a.scrollTop=s)}}},_focusSearchField:function(){this._getSearchField().focus()},_getSearchField:function(){return this.element.querySelector(this.get("searchFieldSelector"))},_getHiddenField:function(){return this.element.querySelector(this.get("hiddenFieldSelector"))},_moveFocusedRecipient:function(e){var t=this.get("possibleRecipients")
if(t&&0!==t.length){var i=this.get("focusedRecipient"),s=t.indexOf(i),n=this.get("possibleRecipients.length"),a=i?(s+e+n)%n:0
this._setFocusedRecipient(t.objectAt(a))}},_setFocusedRecipient:function(e){this._ensureRecipientIsScrolledIntoView(e)
this.set("focusedRecipient",e)},_sendA11yNotification:function(e,t){var i=a[e]
if(!i){i=this.get("i18n").getMessageRenderer(s.default,e)
a[e]=i}return this.get("a11yNotification").setTextInLiveRegion(i([t]))},_fetchRecipients:function(e,t){var i=this
if(e){var s=t||[o]
this.get("includeGroupConversationResults")&&!this.get("recipients.length")&&s.push(r)
this.setProperties({recipientsLoading:!0,isSuggestedList:!1})
this.msgDataManager.fetchTypeaheadResults(e,s).then((function(t){if(!i.isDestroying){t.length?i.setProperties({focusedRecipient:t.get("firstObject"),possibleRecipients:t,isSuggestedList:!1}):i.get("enableGroupComposeFlow")&&i.get("withSuggestedList")&&!e?i.setProperties({focusedRecipient:i.get("suggestedRecipients.firstObject"),possibleRecipients:i.get("suggestedRecipients"),isSuggestedList:!0}):i.set("possibleRecipients",null)
i.setProperties({searchPerformed:!0,recipientsLoading:!1})
i._markSelectedRecipients()
i._sendA11yNotification("i18n_a11y_suggestions_hint_text",{resultsLength:Ember.get(t,"length")})}}))}else{this._closeDropdown()
this._markSelectedRecipients()}},_fetchSuggestedRecipients:function(){var e=this
this.set("recipientsLoading",!0)
this.msgDataManager.fetchSuggestedRecipients().then((function(t){if(!e.isDestroying){e.setProperties({possibleRecipients:t,recipientsLoading:!1,isSuggestedList:!0,suggestedRecipients:t})
e._setFocusedRecipient(t[0])
e._markSelectedRecipients()}}))},_markSelectedRecipients:function(){var e=this.get("recipients")||[],t=this.get("possibleRecipients")
if(t){var i=e.reduce((function(e,t){e.set(t.get("entityUrn"),!0)
return e}),new Map)
t.forEach((function(e){e.set("checked",i.has(e.get("entityUrn")))}))}},_toggleRecipient:function(e,t){var i=this.get("possibleRecipients")
if(i){var s=i.findBy("entityUrn",e.get("entityUrn"))
s&&s.set("checked",t)}},actions:{addRecipient:function(e){var t=this
this.get("recipients").addObject(e)
this.recipientsChanged(this.get("recipients"))
this._sendA11yNotification("i18n_a11y_added_recipient",{name:Ember.get(e,"name")})
this._getSearchField().value=""
this.set("searchTerm","")
this._closeDropdown()
this._toggleRecipient(e,!0)
this._focusSearchField();(0,n.mutateDOM)((function(){t.isDestroying||(t.addedRecipientsContainer.scrollTop=t.addedRecipientsContainer.scrollHeight)}))},removeRecipient:function(e){this.get("recipients").removeObject(e)
this.recipientsChanged(this.get("recipients"))
this._toggleRecipient(e,!1)
this._sendA11yNotification("i18n_a11y_removed_recipient",{name:Ember.get(e,"name")})
this._focusSearchField()},debounceFetchRecipients:function(){var e=this.get("searchTerm"),t=this._getSearchField().value
!e&&t&&this.get("tracking").fireInteractionEvent(this.get("beginSearchControlName"))
this.set("searchTerm",t)
var i=this.get("typeaheadTypes")
if(Ember.testing)this._fetchRecipients(t,i)
else{Ember.run.cancel(this.debounce)
var s=Ember.testing?0:500
this.debounce=this.debounceTask("_fetchRecipients",t,i,s)}},onListItemHover:function(e){this.set("focusedRecipient",e)}}})
e.default=m})
define("msg-typeahead/templates/components/connections-typeahead-v2",["exports"],function(e){"use strict"
Object.defineProperty(e,"__esModule",{value:!0})
e.default=void 0
var t=Ember.HTMLBars.template({id:"b/jTww7v",block:'{"symbols":["recipient","recipient"],"statements":[[4,"if",[[23,["a11yText"]]],null,{"statements":[[0,"  "],[7,"label"],[12,"for",[28,[[21,"elementId"],"-search-field"]]],[11,"class","visually-hidden"],[9],[1,[21,"a11yText"],false],[10],[0,"\\n"]],"parameters":[]},null],[7,"section"],[11,"class","msg-connections-typeahead__top-fixed-section"],[9],[0,"\\n  "],[7,"div"],[11,"class","msg-connections-typeahead__added-recipients"],[9],[0,"\\n"],[4,"each",[[23,["recipients"]]],null,{"statements":[[0,"      "],[1,[27,"artdeco-pill@artdeco-pill-dismiss",null,[["class","text","a11yText","onDismiss","size"],["m1",[27,"ember-cli-pemberly-i18n@format-name",null,[["firstName","lastName","type"],[[22,2,["firstName"]],[22,2,["lastName"]],"full"]]],[27,"t",["i18n_remove_recipient","msg-typeahead/templates/components/connections-typeahead-v2"],[["recipientName"],[[27,"data-layer@name",[[22,2,[]]],null]]]],[27,"action",[[22,0,[]],"removeRecipient",[22,2,[]]],null],1]]],false],[0,"\\n"]],"parameters":[2]},null],[0,"\\n    "],[7,"input"],[12,"id",[27,"concat",[[23,["elementId"]],"-search-field"],null]],[12,"class",[27,"concat",["msg-connections-typeahead__search-field",[27,"unless",[[23,["recipients"]]," msg-connections-typeahead__search-field--no-recipients"],null],[27,"if",[[23,["displaySearchIcon"]]," ml6"," ml1"],null]],null]],[12,"autofocus",[21,"autofocus"]],[12,"placeholder",[27,"unless",[[23,["recipients"]],[23,["placeholder"]]],null]],[11,"role","combobox"],[11,"aria-autocomplete","list"],[12,"aria-owns",[27,"concat",[[23,["elementId"]],"-suggestions-menu"],null]],[12,"aria-expanded",[27,"if",[[23,["possibleRecipients"]],"true","false"],null]],[12,"aria-activedescendant",[23,["focusedRecipient","entityUrn"]]],[11,"type","text"],[3,"action",[[22,0,[]],"debounceFetchRecipients"],[["on"],["input"]]],[9],[10],[0,"\\n\\n"],[4,"if",[[23,["displaySearchIcon"]]],null,{"statements":[[0,"      "],[1,[27,"ember-cli-pemberly-artdeco@li-icon",null,[["aria-hidden","class","type","size"],["true","msg-connections-typeahead__search-field-icon","search-icon","large"]]],false],[0,"\\n"]],"parameters":[]},null],[0,"\\n    "],[7,"div"],[11,"class","msg-connections-typeahead__hidden-field"],[9],[10],[0,"\\n  "],[10],[0,"\\n\\n"],[4,"if",[[23,["isSuggestedList"]]],null,{"statements":[[0,"    "],[7,"div"],[11,"class","t-bold t-14 t-black--light pb2 pl3 pt2"],[9],[1,[27,"t",["i18n_suggested","msg-typeahead/templates/components/connections-typeahead-v2"],null],false],[10],[0,"\\n"]],"parameters":[]},null],[10],[0,"\\n"],[4,"if",[[23,["displaySearchResults"]]],null,{"statements":[[0,"  "],[7,"div"],[12,"class",[27,"if",[[23,["withSuggestedList"]],"msg-connections-typeahead__inplace-search-results","msg-connections-typeahead__search-results container"],null]],[9],[0,"\\n"],[4,"if",[[23,["recipientsLoading"]]],null,{"statements":[[0,"      "],[7,"div"],[11,"class","msg-connections-typeahead__recipients-list-loading"],[9],[0,"\\n        "],[5,"artdeco-loader@artdeco-loader",[[11,"class","mhA"]],[[],[]]],[0,"\\n      "],[10],[0,"\\n"]],"parameters":[]},{"statements":[[4,"if",[[23,["possibleRecipients"]]],null,{"statements":[[0,"      "],[7,"ul"],[11,"class","list-style-none"],[11,"role","listbox"],[12,"id",[27,"concat",[[23,["elementId"]],"-suggestions-menu"],null]],[9],[0,"\\n"],[4,"each",[[23,["possibleRecipients"]]],null,{"statements":[[0,"          "],[7,"li"],[11,"role","presentation"],[12,"onmouseover",[27,"action",[[22,0,[]],"onListItemHover",[22,1,[]]],null]],[9],[0,"\\n"],[4,"if",[[27,"global-helpers@eq",[[22,1,["recipientType"]],[23,["CONVERSATION"]]],null]],null,{"statements":[[0,"              "],[7,"button"],[12,"class",[28,["display-flex flex-row align-items-center msg-connections-typeahead__search-result pl3 ",[27,"if",[[27,"global-helpers@eq",[[23,["focusedRecipient"]],[22,1,[]]],null],"msg-connections-typeahead__search-result--focused"],null]]]],[11,"tabindex","-1"],[11,"role","option"],[12,"id",[22,1,["entityUrn"]]],[12,"aria-selected",[27,"if",[[27,"global-helpers@eq",[[22,1,["entityUrn"]],[23,["focusedRecipient","entityUrn"]]],null],"true","false"],null]],[12,"onmousedown",[27,"tracked-action",[[23,["openConversationControlName"]],[27,"action",[[22,0,[]],[23,["openConversation"]],[22,1,["conversationId"]]],null]],null]],[9],[0,"\\n                "],[1,[27,"messaging-base@primitives/facepile-grid",null,[["participants","entitySize"],[[22,1,["miniProfiles"]],"small"]]],false],[0,"\\n                "],[7,"div"],[11,"class","msg-connections-typeahead__entity-description display-flex"],[9],[0,"\\n                  "],[7,"dl"],[11,"class","display-flex flex-column truncate"],[9],[0,"\\n                    "],[7,"dt"],[11,"class","t-14 t-black t-bold truncate"],[9],[1,[22,1,["text"]],false],[10],[0,"\\n                    "],[7,"dd"],[11,"class","t-12 t-black--light t-normal truncate"],[9],[1,[22,1,["subtext"]],false],[10],[0,"\\n                  "],[10],[0,"\\n                "],[10],[0,"\\n              "],[10],[0,"\\n"]],"parameters":[]},{"statements":[[0,"              "],[7,"button"],[12,"class",[28,["display-flex flex-row align-items-center msg-connections-typeahead__search-result pl3 ",[27,"if",[[27,"global-helpers@eq",[[23,["focusedRecipient"]],[22,1,[]]],null],"msg-connections-typeahead__search-result--focused"],null]]]],[11,"tabindex","-1"],[11,"role","option"],[12,"id",[22,1,["entityUrn"]]],[12,"aria-selected",[27,"if",[[27,"global-helpers@eq",[[22,1,["entityUrn"]],[23,["focusedRecipient","entityUrn"]]],null],"true","false"],null]],[12,"onmousedown",[27,"tracked-action",[[23,["addRecipientControlName"]],[27,"action",[[22,0,[]],"addRecipient",[22,1,["miniProfile"]]],null]],null]],[9],[0,"\\n                "],[1,[27,"presence@entity-with-presence",null,[["classNames","indicatorClasses","miniProfile","size"],["msg-connections-typeahead__presence-entity","msg-connections-typeahead__presence-entity-indicator",[22,1,["miniProfile"]],2]]],false],[0,"\\n                "],[7,"div"],[11,"class","msg-connections-typeahead__entity-description display-flex"],[9],[0,"\\n                  "],[7,"dl"],[11,"class","display-flex flex-column truncate msg-connections-typeahead__entity-description-list"],[9],[0,"\\n                    "],[7,"dt"],[11,"class","t-14 t-black t-bold truncate"],[9],[0,"\\n                      "],[1,[27,"ember-cli-pemberly-i18n@format-name",null,[["firstName","lastName","type","color"],[[22,1,["miniProfile","firstName"]],[22,1,["miniProfile","lastName"]],"full",true]]],false],[0,"\\n                    "],[10],[0,"\\n                    "],[7,"dd"],[11,"class","t-12 t-black--light t-normal truncate"],[9],[1,[22,1,["caption"]],false],[10],[0,"\\n                  "],[10],[0,"\\n"],[4,"if",[[22,1,["checked"]]],null,{"statements":[[0,"                    "],[7,"span"],[9],[1,[27,"ember-cli-pemberly-artdeco@li-icon",null,[["aria-hidden","class","type","size"],["true","msg-connections-typeahead__check-icon","check-icon","large"]]],false],[10],[0,"\\n"]],"parameters":[]},null],[0,"                "],[10],[0,"\\n              "],[10],[0,"\\n"]],"parameters":[]}],[0,"          "],[10],[0,"\\n"]],"parameters":[1]},null],[0,"      "],[10],[0,"\\n"]],"parameters":[]},{"statements":[[0,"      "],[7,"div"],[11,"class","msg-connections-typeahead__no-result p2 display-flex align-items-center"],[9],[0,"\\n        "],[5,"artdeco-inline-feedback@artdeco-inline-feedback",[],[["@message"],[[27,"t",["i18n_no_connection_results","msg-typeahead/templates/components/connections-typeahead-v2"],null]]]],[0,"\\n      "],[10],[0,"\\n    "]],"parameters":[]}]],"parameters":[]}],[0,"  "],[10],[0,"\\n"]],"parameters":[]},null]],"hasEval":false}',meta:{moduleName:"msg-typeahead/templates/components/connections-typeahead-v2.hbs"}})
e.default=t})

//# sourceMappingURL=engine-vendor.map